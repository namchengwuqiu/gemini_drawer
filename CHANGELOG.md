# Gemini 绘图插件 更新日志

## v1.5.2 (2025-12-29)

### 新增功能
- **多图生图命令** (`/多图`) 🆕
  - 新增 `/多图 <提示词>` 命令
  - 支持至少 2 张图片作为输入
  - 增强图片获取逻辑，支持从回复的消息中提取图片
  - 图片来源优先级：回复消息 > 当前消息图片 > @用户头像

---

## v1.5.1 (2025-12-28)

### 新增功能
- **删除渠道 Key** 🆕
  - 新增 `/渠道删除key <渠道> <序号>` 命令
  - 可删除指定渠道的特定 Key

- **豆包图生图支持**
  - 豆包 API 现在支持图生图功能（`/bnn`、`/+预设` 命令）
  - 自动检测是否有源图片，有则添加 `image` 参数

### 修复
- **API 响应解析修复**
  - 修复 `content` 为数组格式时无法提取图片的问题
  - 支持 `{"type": "image", "image": {"data": "..."}}` 格式
  - 支持 `{"type": "image_url", "image_url": {"url": "..."}}` 格式
  - 支持 `message.images` 数组格式（图片与 content 分离的响应）

### 改进
- **日志优化**
  - 使用 `safe_json_dumps` 自动截断 base64 数据
  - 避免日志中出现过长的图片数据

---

## v1.5.0 (2025-12-27)

### 新增功能
- **火山豆包 API 支持** 🆕
  - 新增对火山引擎豆包图片生成 API 的支持
  - 支持 `/images/generations` 端点格式
  - 支持 URL 返回和 base64 返回两种格式

### 改进
- **添加渠道命令优化**
  - 现在支持三种 API 格式：OpenAI、Gemini、豆包
  - 改进的格式验证和错误提示
  - 添加成功后显示 API 类型和下一步操作引导

### 代码重构
- 将插件拆分为多个模块文件，提高可维护性
- 为每个模块添加详细的文档注释

---

## v1.4.2 (2025-12-26)

### 改进
- **查看提示词命令优化**
  - 现在以聊天记录格式发送提示词内容（与 `/基咪绘图帮助` 一致）
  - 更清晰的内容展示

### 修复
- 修复帮助文本中无效转义序列 `\|` 的警告
- 更新默认 API 端点为 `gemini-3-pro-image`

---

## v1.4.1 (2025-12-24)

### 新增功能
- **回复图片模式** (`behavior.reply_with_image`)
  - 生成的图片以回复触发消息的方式发送
  - 开启后自动跳过成功通知（戳一戳/文字）
  - 默认开启
  
- **管理员专用模式** (`behavior.admin_only_mode`)
  - 开启后仅管理员可使用绘图功能
  - 非管理员触发时提示"⚠️ 管理员已关闭绘图功能"
  - 默认关闭

- **查看提示词命令** (`/查看提示词 名称`)
  - 查看指定提示词的完整内容

### 技术改进
- 使用直接构造 `DatabaseMessages` 对象的方式实现图片回复，避免数据库查询延迟问题

---

## v1.3.2 及更早版本

请参阅 README.md 中的历史功能说明。
